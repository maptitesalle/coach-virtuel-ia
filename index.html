<!DOCTYPE html>
<html lang="fr">
<head>
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

  <meta charset="UTF-8" />
  <title>Ma P’tite Salle - Coach Virtuel IA</title>
  <style>
    /* ... Ton style existant ... (omitted for brevity) */
  </style>
</head>

<body>
  <header>
    <h1>Ma P’tite Salle - Coach Virtuel IA</h1>
  </header>

  <div class="container">
    <h2>Formulaire d'Âges Biologiques</h2>

    <form id="ageForm">
      <!-- ... Tous tes champs fieldset ... -->
      <!-- Section Force, Flexibilité, Métabolique, Cardio -->
      <!-- Comme dans les exemples précédents -->
      <button type="button" id="submitBtn">Obtenir un conseil IA</button>
    </form>

    <div id="response"></div>
  </div>

  <footer>
    © 2025 - Ma P'tite Salle
  </footer>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('ageForm');
    const submitBtn = document.getElementById('submitBtn');
    const responseDiv = document.getElementById('response');

    submitBtn.addEventListener('click', async () => {
      const formData = new FormData(form);
      const data = {
        forceHaut: formData.get('forceHaut'),
        forceMilieu: formData.get('forceMilieu'),
        forceBas: formData.get('forceBas'),
        flexCou: formData.get('flexCou'),
        flexEpaules: formData.get('flexEpaules'),
        flexLombaires: formData.get('flexLombaires'),
        flexIschios: formData.get('flexIschios'),
        flexHanches: formData.get('flexHanches'),
        poids: formData.get('poids'),
        masseGrasse: formData.get('masseGrasse'),
        masseMuscu: formData.get('masseMuscu'),
        ageMetabo: formData.get('ageMetabo'),
        vo2max: formData.get('vo2max'),
        ageCardio: formData.get('ageCardio')
      };

      // Message d'attente
      responseDiv.innerHTML = "En cours de génération...";

      try {
        // Appel à la fonction serverless "ai"
        const res = await fetch('/.netlify/functions/ai', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        const json = await res.json();

        if (json.error) {
          responseDiv.innerHTML = `<p style="color:red;">Erreur: ${json.error}</p>`;
        } else {
          // Afficher le texte généré par l'IA
          responseDiv.innerHTML = `
            <h3>Conseil IA :</h3>
            <p>${json.reply}</p>
          `;
        }

      } catch (err) {
        console.error(err);
        responseDiv.innerHTML = '<p style="color:red;">Une erreur s\'est produite.</p>';
      }
    });
  });
  </script>
</body>
</html>
