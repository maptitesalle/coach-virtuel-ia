<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Ma P’tite Salle - Coach Virtuel IA</title>
  <style>
    /* ----- Style basique, couleurs chaudes ----- */
    body {
      font-family: Arial, sans-serif;
      background-color: #fdf7f3;
      margin: 0; 
      padding: 0 1em 2em;
    }
    header {
      background-color: #ed7e22;
      color: #fff; 
      padding: 1em; 
      text-align: center; 
      margin-bottom: 1em;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      background: #fff8f2;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
      border-radius: 8px;
      padding: 1.5em;
    }
    fieldset { 
      border: 1px solid #ebebeb; 
      border-radius: 5px; 
      margin-bottom: 1.5em; 
      padding: 1em;
      background-color: #fff;
    }
    legend {
      color: #ed7e22;
      font-weight: bold;
      padding: 0.2em 0.6em;
    }
    label { display: block; margin: 0.5em 0; }
    input[type="number"] {
      width: 100%; 
      padding: 0.4em; 
      margin-bottom: 0.5em;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
    button {
      background-color: #ed7e22;
      color: #fff;
      border: none;
      padding: 0.6em 1.2em;
      font-size: 1em;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #da711f;
    }
    #response {
      margin-top: 1em; 
      padding: 1em; 
      background: #fff6ed; 
      border-radius: 6px;
      min-height: 50px;
    }
    footer {
      margin-top: 2em; 
      text-align: center; 
      font-size: 0.8em; 
      color: #aaaaaa;
    }
  </style>
</head>

<body>
  <header>
    <h1>Ma P’tite Salle - Coach Virtuel IA</h1>
  </header>

  <div class="container">
    <h2>Formulaire d'Âges Biologiques</h2>
    <form id="ageForm">
      <!-- Section Force -->
      <fieldset>
        <legend>Âge biologique de la force</legend>
        <label>Haut du corps :
          <input type="number" name="forceHaut" placeholder="Ex: 35">
        </label>
        <label>Milieu du corps :
          <input type="number" name="forceMilieu" placeholder="Ex: 40">
        </label>
        <label>Bas du corps :
          <input type="number" name="forceBas" placeholder="Ex: 30">
        </label>
      </fieldset>

      <!-- Section Flexibilité -->
      <fieldset>
        <legend>Âge biologique de la flexibilité</legend>
        <label>Cou :
          <input type="number" name="flexCou">
        </label>
        <label>Épaules :
          <input type="number" name="flexEpaules">
        </label>
        <label>Lombaires :
          <input type="number" name="flexLombaires">
        </label>
        <label>Ischios :
          <input type="number" name="flexIschios">
        </label>
        <label>Hanches :
          <input type="number" name="flexHanches">
        </label>
      </fieldset>

      <!-- Section Métabolique -->
      <fieldset>
        <legend>Âge biologique métabolique</legend>
        <label>Poids (kg):
          <input type="number" step="0.1" name="poids">
        </label>
        <label>% Masse graisseuse :
          <input type="number" step="0.1" name="masseGrasse">
        </label>
        <label>% Masse musculaire :
          <input type="number" step="0.1" name="masseMuscu">
        </label>
        <label>Âge métabolique :
          <input type="number" name="ageMetabo">
        </label>
      </fieldset>

      <!-- Section Cardio -->
      <fieldset>
        <legend>Âge cardio</legend>
        <label>VO2max :
          <input type="number" step="0.1" name="vo2max">
        </label>
        <label>Âge cardio :
          <input type="number" name="ageCardio">
        </label>
      </fieldset>

      <button type="button" id="submitBtn">Obtenir un conseil IA</button>
    </form>

    <div id="response"></div>
  </div>

  <footer>
    © 2025 - Ma P'tite Salle
  </footer>

  <!-- Script JS intégré directement ci-dessous -->
  <script>
document.addEventListener('DOMContentLoaded', () => {
  const form = document.getElementById('ageForm');
  const submitBtn = document.getElementById('submitBtn');
  const responseDiv = document.getElementById('response');

  submitBtn.addEventListener('click', async () => {
    // 1. Récupérer données du formulaire
    const formData = new FormData(form);
    const data = {
      forceHaut: formData.get('forceHaut'),
      forceMilieu: formData.get('forceMilieu'),
      forceBas: formData.get('forceBas'),
      flexCou: formData.get('flexCou'),
      flexEpaules: formData.get('flexEpaules'),
      flexLombaires: formData.get('flexLombaires'),
      flexIschios: formData.get('flexIschios'),
      flexHanches: formData.get('flexHanches'),
      poids: formData.get('poids'),
      masseGrasse: formData.get('masseGrasse'),
      masseMuscu: formData.get('masseMuscu'),
      ageMetabo: formData.get('ageMetabo'),
      vo2max: formData.get('vo2max'),
      ageCardio: formData.get('ageCardio')
    };

    // 2. Message d'attente
    responseDiv.innerHTML = "Envoi en cours...";

    try {
      // 3. Appeler la fonction serverless (ai.js)
      const res = await fetch('/.netlify/functions/ai', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });

      // 4. Récupérer la réponse en JSON
      const json = await res.json();

      // 5. Afficher la réponse
      if (json.error) {
        // S'il y a une erreur côté serverless, on l'affiche
        responseDiv.innerHTML = `<p style="color:red;">Erreur: ${json.error}</p>`;
      } else {
        // "reply" est la propriété qu'on renvoie dans ai.js
        responseDiv.innerHTML = `<h3>Réponse du serveur :</h3><p>${json.reply}</p>`;
      }

    } catch (err) {
      console.error(err);
      responseDiv.innerHTML = `<p style="color:red;">Une erreur s'est produite.</p>`;
    }
  });
});
</script>


</body>
</html>
